!function(e,t,o){"object"==typeof exports&&"object"==typeof module?module.exports=o(t):"function"==typeof define&&define.amd?define([],o):"object"==typeof exports?exports.pm=o(t):e.pm=o(t)}(this,window,function(e){"use strict";var t=function(){for(var e=arguments,t=e[0],o=1,a=e.length;o<a;o++){var n=e[o];for(var r in n)t[r]=n[r]}return t},o={postMessage:function(){var t=this,o=function(t){var o;try{o=e.JSON.parse(t.data)}catch(t){o=t.data}o.type&&s.trigger({data:o,origin:t.origin,source:t.source})};t.send=function(t,o,a){o=e.JSON.stringify(o),t.postMessage(o,a)},e.addEventListener?e.addEventListener("message",o,!1):e.attachEvent&&e.attachEvent("onmessage",o)},opener:function(){var t=this,o=e.location.protocol+"//"+e.location.host,a=[],n=function(t){try{return void(t.source.window.document&&t.source.window.document!=document&&(t.source.window.document.domain="unknownhost",console.warn("Error document, not real.")))}catch(a){}"*"!=t.origin&&t.origin.replace(/\//g,"")!=o.replace(/\//g,"")||s.trigger({data:e.JSON.parse(t.data),origin:t.source.origin,source:t.source.window})};setInterval(function(){if(e.opener&&e.opener.postMessage)for(var t=e.opener.postMessage,o=0;o<t.length;)t[o].target==e?n(t.splice(o,1)[0]):o++},100),t.send=function(t,n,r){a.push({source:{window:e,origin:o},data:e.JSON.stringify(n),origin:r,target:t});try{t.opener={postMessage:a}}catch(s){console.warn('Target not support "opener.postMessage";'+s.message)}}},hash:function(){}},a=new o[e.postMessage?"postMessage":"opener"],n={},r=0,s={handler:a,defaults:{target:null,type:null,data:null,callback:null,complete:null,origin:"*"},send:function(e,o,n,i){var c={};c="object"==typeof e?e:t({type:e,target:o,data:n},i);var p=t({},s.defaults,c),d=p.target,l=++r;if(!p.target||!p.type)throw new Error("Arguments [target,type] required");return p.callback&&this.bind("postMessage.callback."+l,function(e){e.source==p.target&&p.callback.apply(e,e.data)},!0),p.complete&&this.bind("postMessage.complete."+l,function(e){e.source==p.target&&p.complete.call(e,e.data)},!0),a.send(d,{data:p.data,type:p.type,callback:!!p.callback,complete:!!p.complete,id:l},p.origin||"*"),l},bind:function(e,t,o){n[e]=n[e]||[],n[e].push([function(e){var o=e.data,n=function(){e.callback&&a.send(e.source,{data:Array.prototype.slice.call(arguments),type:"postMessage.callback."+e.id},e.origin)},r=t.call(this,{data:o,source:e.source,origin:e.origin,callback:n});e.complete&&a.send(e.source,{data:r,type:"postMessage.complete."+e.id},e.origin)},o])},one:function(e,t){this.bind(e,t,!0)},trigger:function(e){if(e.data.origin=e.origin,e.data.source=e.source,n[e.data.type])for(var t=0;t<n[e.data.type].length;t++)n[e.data.type][t][0](e.data),n[e.data.type][t][1]&&n[e.data.type].splice(t,1)}};return s});