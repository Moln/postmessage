!function(e,t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(t):"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.pm=n(t):e.pm=n(t)}(this,window,function(window){"use strict";window.JSON||(window.JSON={parse:function(sJSON){return eval("("+sJSON+")")},stringify:function(e){if(e instanceof Object){var t="";if(e.constructor===Array){for(var n=0;n<e.length;t+=this.stringify(e[n])+",",n++);return"["+t.substr(0,t.length-1)+"]"}if(e.toString!==Object.prototype.toString)return'"'+e.toString().replace(/"/g,"\\$&")+'"';for(var o in e)t+='"'+o.replace(/"/g,"\\$&")+'":'+this.stringify(e[o])+",";return"{"+t.substr(0,t.length-1)+"}"}if("string"==typeof e)return'"'+e.replace(/"/g,"\\$&")+'"';try{return this.parse(String(e)),String(e)}catch(r){return'"'+String(e)+'"'}}});var extend=function(){for(var e=arguments[0],t=1,n=arguments.length;t<n;t++){var o=arguments[t];for(var r in o)e[r]=o[r]}return e},handlers={postMessage:function(){var e=function(e){try{var t=window.JSON.parse(e.data)}catch(n){return}t.type&&pm.trigger({data:t,origin:e.origin,source:e.source})};this.send=function(e,t,n){t=window.JSON.stringify(t),e.postMessage(t,n)},window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent&&window.attachEvent("onmessage",e)},opener:function(){var e=window.location.protocol+"//"+window.location.host,t=[],n=function(t){try{return void(t.source.window.document&&t.source.window.document!=document&&(t.source.window.document.domain="unknownhost",console.warn("Error document, not real.")))}catch(n){}"*"!=t.origin&&t.origin.replace(/\//g,"")!=e.replace(/\//g,"")||pm.trigger({data:window.JSON.parse(t.data),origin:t.source.origin,source:t.source.window})};setInterval(function(){if(window.opener&&window.opener.postMessage)for(var e=window.opener.postMessage,t=0;t<e.length;)e[t].target==window?n(e.splice(t,1)[0]):t++},100);this.send=function(n,o,r){t.push({source:{window:window,origin:e},data:window.JSON.stringify(o),origin:r,target:n});try{n.opener={postMessage:t}}catch(a){console.warn('Target not support "opener.postMessage";'+a.message)}}},hash:function(){}},handler=new handlers[window.postMessage?"postMessage":"opener"],events={},eventTick=0,pm={handler:handler,defaults:{target:null,type:null,data:null,callback:null,complete:null,origin:"*"},send:function(e,t,n,o){var r={};r="object"==typeof e?e:extend({type:e,target:t,data:n},o);var a=extend({},pm.defaults,r),i=a.target,s=++eventTick;if(!a.target||!a.type)throw new Error("Arguments [target,type] required");return a.callback&&this.bind("postMessage.callback."+s,function(e){e.source==a.target&&a.callback.apply(e,e.data)},!0),a.complete&&this.bind("postMessage.complete."+s,function(e){e.source==a.target&&a.complete.call(e,e.data)},!0),handler.send(i,{data:a.data,type:a.type,callback:!!a.callback,complete:!!a.complete,id:s},a.origin||"*"),s},bind:function(e,t,n){events[e]=events[e]||[],events[e].push([function(e){var n=e.data,o=function(){e.callback&&handler.send(e.source,{data:Array.prototype.slice.call(arguments),type:"postMessage.callback."+e.id},e.origin)},r=t.call(this,{data:n,source:e.source,origin:e.origin,callback:o});e.complete&&handler.send(e.source,{data:r,type:"postMessage.complete."+e.id},e.origin)},n])},one:function(e,t){this.bind(e,t,!0)},trigger:function(e){if(e.data.origin=e.origin,e.data.source=e.source,events[e.data.type])for(var t=0;t<events[e.data.type].length;t++)events[e.data.type][t][0](e.data),events[e.data.type][t][1]&&events[e.data.type].splice(t,1)}};return pm});